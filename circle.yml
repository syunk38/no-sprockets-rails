machine:
  timezone:
    Asia/Tokyo
  ruby:
    version: 2.3.0
  node:
    version: 6.9.1

dependencies:
  cache_directories:
    - "vendor/bundle"
    - "node_modules"

  override:
    - rm Gemfile.lock
    - bundle install --path vendor/bundle

test:
  override:
    - echo "Nothing to do here"

deployment:
  production:
    branch: master
    commands:
      - "[[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]] || git fetch --unshallow"
      - npm install
      - npm rebuild node-sass
      - npm run build
      - git commit -m 'asset build'
      - git push git@heroku.com:no-sprockets-rails.git $CIRCLE_SHA1:refs/heads/master
      - heroku run rake db:migrate --app no-sprockets-rails:
          timeout: 400 # if your deploys take a long time
